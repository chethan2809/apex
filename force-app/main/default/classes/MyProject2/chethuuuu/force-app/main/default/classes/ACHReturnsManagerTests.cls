@isTest
private class ACHReturnsManagerTests {

    @isTest
    private static void processACHReturnFiles() {
        GeneralHelper.currentSystemDate = TestUtility.currentSystemDate;
        GeneralHelper.currentSystemDateTime = DateTime.newInstance(GeneralHelper.currentSystemDate, DateTime.Now().Time());

        DBManagerTestsStub documentDBStubInstance = new DBManagerTestsStub();
        ACHReturnsManager.documentDBInstance = (DocumentDB) Test.createStub(DocumentDB.class, documentDBStubInstance);

        List<Object> achReturnObject = new  List<Object>();
        achReturnObject.add(new List<Object>
        {
            '49', '48', '49', '32', '54', '57', '49', '48', '48', '48', '49', '51', '52', '32', '54', '57', '49', '48', '48', '48', '49', '51', '52', '49', '56', '48', '50', '50', '51', '48', '55', '53', '48', '90', '48', '57', '52', '49', '48', '49', '65', '67', '72', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '65', '67', '72', '32', '32', '32', '32', '32', '32', '32', '13', '10', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '53', '50', '48', '48', '67', '79', '77', '80', '65', '78', '89', '32', '78', '65', '77', '69', '32', '32', '32', '32', '52', '73', '78', '70', '79', '32', '53', '53', '53', '45', '53', '53', '53', '45', '53', '53', '53', '53', '32', '32', '13', '10', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '87', '69', '66', '80', '82', '69', '65', '85', '84', '72', '80', '77', '84', '49', '56', '48', '50', '50', '49', '49', '56', '48', '50', '50', '50', '48', '53', '51', '49', '50', '50', '49', '52', '55', '51', '54', '53', '48', '48', '48', '48', '50', '55', '57', '13', '10', '54', '50', '54', '48', '50', '54', '48', '55', '51', '49', '56', '57', '48', '48', '48', '48', '48', '49', '50', '51', '52', '53', '32', '32', '32', '32', '32', '32', '32', '48', '48', '48', '48', '48', '53', '54', '52', '57', '48', '76', '65', '73', '48', '48', '48', '48', '48', '48', '48', '49', '56', '32', '32', '32', '79', '84', '79', '79', '76', '69', '32', '72', '79', '85', '83', '69', '72', '79', '76', '68', '32', '32', '32', '32', '32', '32', '32', '32', '32', '82', '32', '13', '10', '49', '50', '50', '49', '52', '55', '51', '54', '53', '51', '52', '57', '55', '56', '57', '54', '13', '10', '55', '57', '57', '82', '48', '49', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '55', '50', '32', '32', '32', '32', '32', '32', '50', '50', '49', '52', '55', '51', '54', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '50', '49', '52', '55', '51', '54', '53', '51', '52', '57', '55', '56', '57', '54', '13', '10', '56', '50', '48', '48', '48', '48', '48', '48', '48', '50', '48', '48', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '48', '48', '53', '54', '52', '57', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '50', '49', '52', '55', '51', '54', '53', '48', '48', '48', '48', '50', '55', '57', '13', '10', '53', '50', '48', '48', '67', '79', '77', '80', '65', '78', '89', '32', '78', '65', '77', '69', '32', '32', '32', '32', '52', '73', '78', '70', '79', '32', '53', '53', '53', '45', '53', '53', '53', '45', '53', '53', '53', '53', '32', '32', '13', '10', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '80', '80', '68', '80', '82', '69', '65', '85', '84', '72', '80', '77', '84', '49', '56', '48', '50', '50', '48', '49', '56', '48', '50', '50', '49', '48', '53', '51', '49', '50', '51', '49', '51', '55', '50', '54', '57', '52', '57', '57', '48', '52', '57', '57', '13', '10', '54', '50', '54', '48', '50', '54', '48', '55', '51', '49', '56', '57', '48', '48', '48', '48', '48', '49', '50', '51', '52', '53', '32', '32', '32', '32', '32', '32', '32', '48', '48', '48', '48', '48', '54', '53', '57', '53', '48', '76', '65', '73', '48', '48', '48', '48', '48', '48', '48', '50', '56', '32', '32', '32', '79', '84', '79', '79', '76', '69', '32', '72', '79', '85', '83', '69', '72', '79', '76', '68', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '49', '50', '51', '49', '51', '55', '50', '54', '57', '54', '51', '49', '57', '54', '53', '48', '13', '10', '55', '57', '57', '82', '48', '49', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '49', '52', '51', '32', '32', '32', '32', '32', '32', '50', '51', '49', '51', '55', '50', '54', '57', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '51', '49', '51', '55', '50', '54', '57', '54', '51', '49', '57', '54', '53', '48', '13', '10', '56', '50', '48', '48', '48', '48', '48', '48', '48', '50', '48', '48', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '48', '48', '54', '53', '57', '53', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '51', '49', '51', '55', '50', '54', '57', '52', '57', '57', '48', '52', '57', '57', '13', '10', '53', '50', '48', '48', '67', '79', '77', '80', '65', '78', '89', '32', '78', '65', '77', '69', '32', '32', '32', '32', '52', '73', '78', '70', '79', '32', '53', '53', '53', '45', '53', '53', '53', '45', '53', '53', '53', '53', '32', '32', '13', '10', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '80', '80', '68', '80', '82', '69', '65', '85', '84', '72', '80', '77', '84', '49', '56', '48', '50', '50', '48', '49', '56', '48', '50', '50', '49', '48', '53', '52', '49', '48', '49', '49', '49', '48', '51', '48', '57', '48', '48', '48', '55', '50', '57', '56', '13', '10', '54', '50', '54', '48', '50', '54', '48', '55', '51', '49', '56', '57', '48', '48', '48', '48', '48', '49', '50', '51', '52', '53', '32', '32', '32', '32', '32', '32', '32', '48', '48', '48', '48', '48', '56', '52', '52', '50', '57', '76', '65', '73', '48', '48', '48', '48', '48', '48', '48', '49', '55', '32', '32', '32', '79', '84', '79', '79', '76', '69', '32', '72', '79', '85', '83', '69', '72', '79', '76', '68', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '49', '48', '49', '49', '49', '48', '51', '48', '57', '54', '55', '52', '53', '50', '51', '56', '13', '10', '55', '57', '57', '82', '48', '49', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '55', '55', '32', '32', '32', '32', '32', '32', '48', '51', '49', '50', '48', '49', '51', '54', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '48', '49', '49', '49', '48', '51', '48', '57', '54', '55', '52', '53', '50', '51', '56', '13', '10', '56', '50', '48', '48', '48', '48', '48', '48', '48', '50', '48', '48', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '48', '48', '56', '52', '52', '50', '57', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '48', '49', '49', '49', '48', '51', '48', '57', '48', '48', '48', '55', '50', '57', '56', '13', '10', '57', '48', '48', '48', '48', '48', '52', '48', '48', '48', '48', '48', '50', '48', '48', '48', '48', '48', '48', '48', '56', '48', '48', '49', '48', '52', '50', '57', '50', '55', '50', '48', '48', '48', '48', '48', '48', '50', '52', '57', '49', '57', '52', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '32', '32', '32', '32', '32', '32', '32', '13', '10', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57'
        });

        Map<String, Object> documentRecords = new Map<String, Object>();
        documentRecords.put('fileContentList', achReturnObject);

        loan__Loan_Payment_Transaction__c loanPaymentTransaction = (loan__Loan_Payment_Transaction__c) JSON.deserialize(
            '{"Name" : "LPT-000000072" }', loan__Loan_Payment_Transaction__c.class
        );
        loanPaymentTransaction.Id = TestUtility.getFakeId(loan__Loan_Payment_Transaction__c.getSObjectType());
        loanPaymentTransaction.loan__Reversed__c = false;
        List<loan__Loan_Payment_Transaction__c> loanPaymentTxnList = new List<loan__Loan_Payment_Transaction__c> {loanPaymentTransaction};
        String jsonLPT = '{"totalSize" : 1, "done" : true, "records" : ' + JSON.serialize(loanPaymentTxnList, false) + '}';

        loan__Loan_Account__c clContract = (loan__Loan_Account__c) JSON.deserialize(
            '{"Name" : "LAI-00000018", "loan__Loan_Payment_Transactions__r" : ' + jsonLPT + '}', loan__Loan_Account__c.class
        );
        clContract.Id = TestUtility.getFakeId(loan__Loan_Account__c.getSObjectType());

        DBManagerTestsStub clContractStubDBInstance = new DBManagerTestsStub();
        clContractStubDBInstance.genericReturnObject = new List<loan__Loan_Account__c> {clContract};
        ACHReturnsManager.clContractDBInstance = (CLContractDB) Test.createStub(CLContractDB.class, clContractStubDBInstance);

        Test.startTest();
            Integer filesProcessedCount = ACHReturnsManager.processACHReturnFiles(documentRecords);
        Test.stopTest();

        System.assertEquals(1, filesProcessedCount);
        System.assertEquals(1, documentDBStubInstance.forInsertSObjects.size());
    }

    @isTest
    private static void processACHReturnFilesException() {
        GeneralHelper.currentSystemDate = TestUtility.currentSystemDate;
        GeneralHelper.currentSystemDateTime = DateTime.newInstance(GeneralHelper.currentSystemDate, DateTime.Now().Time());

        List<Object> achReturnObject = new  List<Object>();
        achReturnObject.add(new List<Object>
        {
            '49', '48', '49', '32', '54', '57', '49', '48', '48', '48', '49', '51', '52', '32', '54', '57', '49', '48', '48', '48', '49', '51', '52', '49', '56', '48', '50', '50', '51', '48', '55', '53', '48', '90', '48', '57', '52', '49', '48', '49', '65', '67', '72', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '65', '67', '72', '32', '32', '32', '32', '32', '32', '32', '13', '10', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '53', '50', '48', '48', '67', '79', '77', '80', '65', '78', '89', '32', '78', '65', '77', '69', '32', '32', '32', '32', '52', '73', '78', '70', '79', '32', '53', '53', '53', '45', '53', '53', '53', '45', '53', '53', '53', '53', '32', '32', '13', '10', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '87', '69', '66', '80', '82', '69', '65', '85', '84', '72', '80', '77', '84', '49', '56', '48', '50', '50', '49', '49', '56', '48', '50', '50', '50', '48', '53', '51', '49', '50', '50', '49', '52', '55', '51', '54', '53', '48', '48', '48', '48', '50', '55', '57', '13', '10', '54', '50', '54', '48', '50', '54', '48', '55', '51', '49', '56', '57', '48', '48', '48', '48', '48', '49', '50', '51', '52', '53', '32', '32', '32', '32', '32', '32', '32', '48', '48', '48', '48', '48', '53', '54', '52', '57', '48', '76', '65', '73', '48', '48', '48', '48', '48', '48', '48', '49', '56', '32', '32', '32', '79', '84', '79', '79', '76', '69', '32', '72', '79', '85', '83', '69', '72', '79', '76', '68', '32', '32', '32', '32', '32', '32', '32', '32', '32', '82', '32', '13', '10', '49', '50', '50', '49', '52', '55', '51', '54', '53', '51', '52', '57', '55', '56', '57', '54', '13', '10', '55', '57', '57', '82', '48', '49', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '55', '48', '32', '32', '32', '32', '32', '32', '50', '50', '49', '52', '55', '51', '54', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '50', '49', '52', '55', '51', '54', '53', '51', '52', '57', '55', '56', '57', '54', '13', '10', '56', '50', '48', '48', '48', '48', '48', '48', '48', '50', '48', '48', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '48', '48', '53', '54', '52', '57', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '50', '49', '52', '55', '51', '54', '53', '48', '48', '48', '48', '50', '55', '57', '13', '10', '53', '50', '48', '48', '67', '79', '77', '80', '65', '78', '89', '32', '78', '65', '77', '69', '32', '32', '32', '32', '52', '73', '78', '70', '79', '32', '53', '53', '53', '45', '53', '53', '53', '45', '53', '53', '53', '53', '32', '32', '13', '10', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '80', '80', '68', '80', '82', '69', '65', '85', '84', '72', '80', '77', '84', '49', '56', '48', '50', '50', '48', '49', '56', '48', '50', '50', '49', '48', '53', '51', '49', '50', '51', '49', '51', '55', '50', '54', '57', '52', '57', '57', '48', '52', '57', '57', '13', '10', '54', '50', '54', '48', '50', '54', '48', '55', '51', '49', '56', '57', '48', '48', '48', '48', '48', '49', '50', '51', '52', '53', '32', '32', '32', '32', '32', '32', '32', '48', '48', '48', '48', '48', '54', '53', '57', '53', '48', '76', '65', '73', '48', '48', '48', '48', '48', '48', '48', '50', '56', '32', '32', '32', '79', '84', '79', '79', '76', '69', '32', '72', '79', '85', '83', '69', '72', '79', '76', '68', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '49', '50', '51', '49', '51', '55', '50', '54', '57', '54', '51', '49', '57', '54', '53', '48', '13', '10', '55', '57', '57', '82', '48', '49', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '49', '52', '51', '32', '32', '32', '32', '32', '32', '50', '51', '49', '51', '55', '50', '54', '57', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '51', '49', '51', '55', '50', '54', '57', '54', '51', '49', '57', '54', '53', '48', '13', '10', '56', '50', '48', '48', '48', '48', '48', '48', '48', '50', '48', '48', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '48', '48', '54', '53', '57', '53', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '50', '51', '49', '51', '55', '50', '54', '57', '52', '57', '57', '48', '52', '57', '57', '13', '10', '53', '50', '48', '48', '67', '79', '77', '80', '65', '78', '89', '32', '78', '65', '77', '69', '32', '32', '32', '32', '52', '73', '78', '70', '79', '32', '53', '53', '53', '45', '53', '53', '53', '45', '53', '53', '53', '53', '32', '32', '13', '10', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '80', '80', '68', '80', '82', '69', '65', '85', '84', '72', '80', '77', '84', '49', '56', '48', '50', '50', '48', '49', '56', '48', '50', '50', '49', '48', '53', '52', '49', '48', '49', '49', '49', '48', '51', '48', '57', '48', '48', '48', '55', '50', '57', '56', '13', '10', '54', '50', '54', '48', '50', '54', '48', '55', '51', '49', '56', '57', '48', '48', '48', '48', '48', '49', '50', '51', '52', '53', '32', '32', '32', '32', '32', '32', '32', '48', '48', '48', '48', '48', '56', '52', '52', '50', '57', '76', '65', '73', '48', '48', '48', '48', '48', '48', '48', '49', '55', '32', '32', '32', '79', '84', '79', '79', '76', '69', '32', '72', '79', '85', '83', '69', '72', '79', '76', '68', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '49', '48', '49', '49', '49', '48', '51', '48', '57', '54', '55', '52', '53', '50', '51', '56', '13', '10', '55', '57', '57', '82', '48', '49', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '55', '55', '32', '32', '32', '32', '32', '32', '48', '51', '49', '50', '48', '49', '51', '54', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '48', '49', '49', '49', '48', '51', '48', '57', '54', '55', '52', '53', '50', '51', '56', '13', '10', '56', '50', '48', '48', '48', '48', '48', '48', '48', '50', '48', '48', '48', '50', '54', '48', '55', '51', '49', '56', '48', '48', '48', '48', '48', '48', '48', '56', '52', '52', '50', '57', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '49', '48', '54', '48', '56', '55', '48', '51', '48', '53', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '48', '49', '49', '49', '48', '51', '48', '57', '48', '48', '48', '55', '50', '57', '56', '13', '10', '57', '48', '48', '48', '48', '48', '52', '48', '48', '48', '48', '48', '50', '48', '48', '48', '48', '48', '48', '48', '56', '48', '48', '49', '48', '52', '50', '57', '50', '55', '50', '48', '48', '48', '48', '48', '48', '50', '52', '57', '49', '57', '52', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '48', '32', '32', '32', '32', '32', '32', '32', '13', '10', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '32', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '13', '10', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57', '57'
        });

        Map<String, Object> documentRecords = new Map<String, Object>();
        documentRecords.put('fileContentList', achReturnObject);

        loan__Loan_Payment_Transaction__c loanPaymentTransaction = (loan__Loan_Payment_Transaction__c) JSON.deserialize(
            '{"Name" : "LPT-000000072" }', loan__Loan_Payment_Transaction__c.class
        );
        loanPaymentTransaction.Id = TestUtility.getFakeId(loan__Loan_Payment_Transaction__c.getSObjectType());
        List<loan__Loan_Payment_Transaction__c> loanPaymentTxnList = new List<loan__Loan_Payment_Transaction__c> {loanPaymentTransaction};
        String jsonLPT = '{"totalSize" : 1, "done" : true, "records" : ' + JSON.serialize(loanPaymentTxnList, false) + '}';

        loan__Loan_Account__c clContract = (loan__Loan_Account__c) JSON.deserialize(
            '{"Name" : "LAI-00000018", "loan__Loan_Payment_Transactions__r" :' + jsonLPT + '}', loan__Loan_Account__c.class
        );
        clContract.Id = TestUtility.getFakeId(loan__Loan_Account__c.getSObjectType());

        DBManagerTestsStub errorLogDBStubInstance = new DBManagerTestsStub();
        ACHReturnsManager.errorLogDBInstance = (ErrorLogDB) Test.createStub(ErrorLogDB.class, errorLogDBStubInstance);

        DBManagerTestsStub attachmentDBStubInstance = new DBManagerTestsStub();
        ACHReturnsManager.attachmentDBInstance = (AttachmentDB) Test.createStub(AttachmentDB.class, attachmentDBStubInstance);

        DBManagerTestsStub clContractStubDBInstance = new DBManagerTestsStub();
        clContractStubDBInstance.genericReturnObject = new List<loan__Loan_Account__c> {clContract};
        ACHReturnsManager.clContractDBInstance = (CLContractDB) Test.createStub(CLContractDB.class, clContractStubDBInstance);

        Test.startTest();
            Integer filesProcessedCount = ACHReturnsManager.processACHReturnFiles(documentRecords);
        Test.stopTest();

        System.assertEquals(0, filesProcessedCount);
        System.assertEquals(1, errorLogDBStubInstance.forInsertSObjects.size());
    }

    @isTest
    private static void processACHReturnFilesEmpty() {
        GeneralHelper.currentSystemDate = TestUtility.currentSystemDate;
        GeneralHelper.currentSystemDateTime = DateTime.newInstance(GeneralHelper.currentSystemDate, DateTime.Now().Time());

        List<Object> achReturnObject = new  List<Object>();

        Map<String, Object> documentRecords = new Map<String, Object>();
        documentRecords.put('fileContentList', achReturnObject);

        Test.startTest();
            Integer filesProcessedCount = ACHReturnsManager.processACHReturnFiles(documentRecords);
        Test.stopTest();

        System.assertEquals(0, filesProcessedCount);
    }
}